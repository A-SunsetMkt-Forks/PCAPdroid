## 1.1 What is PCAPdroid

PCAPdroid is an open source android network capture tool which allows you to capture the phone traffic and analyze it remotely (e.g. via Wireshark). The common use cases include:

- Create a PCAP of the network traffic of untrusted apps to detect unwanted behavior
- Decrypt the HTTPS/TLS traffic of an app for debugging purposes/reverse engeneering
- Review which unencrypted information is sent by an app

PCAPdroid requires no root permission. Instead, it leverages the android [VpnService](https://developer.android.com/reference/android/net/VpnService) to receive all the traffic generated by the android apps. Even though the android system thinks that a VPN is active, the traffic is processed locally in your device.

## 1.2 Basic Setup

Before starting, let's first enstablish a terminology:

- *android device*: the android device where PCAPdroid is running
- *target app*: the android app for which the traffic should be captured
- *server PC*/*PC*: the PC where you wish to store/analyze the captured traffic

In the most common setup, the server PC and the android device must be connected to the same local network. This usually means that both the PC and the android device are connected to the same router. This can be easily implemented by using the Hotspot feature of the android device and connecting the PC to it. The PC should be able to ping the android device and viceversa.

<p align="center">
<img src="https://raw.githubusercontent.com/emanuele-f/PCAPdroid/master/assets/screenshots/main_screen.jpg" width="200" />
</p>

The PCAPdroid main view shows the current status of the network capture and the current *dump mode*. The dump mode specifies how the PC is expected to receive the captured traffic. This basic setup assumes that the default "HTTP Server" dump mode is used. After pressing the start button, PCAPdroid will create a VpnService and the android system will ask you to accept the VPN connection. The view will also display the URL to use in order to download the PCAP file containing the captured traffic. You can visit the URL from the PC to start downloading the PCAP. The download will finish once the stop button in PCAPdroid is pressed.

As long as PCAPdroid is running, a key icon will be displayed into the android notification bar. PCAPdroid can be put in background while operating with the other apps as it continues to run as a background service. Other than from the app, PCAPdroid can be stopped from the VPN system settings of android.

<p align="center">
<img src="https://raw.githubusercontent.com/emanuele-f/PCAPdroid/master/assets/screenshots/connections_list.jpg" width="200" />
</p>

The connections tab shows the most recent connections. For each connection, the following information is shown:

  - The app icon, or a question mark if the app is unknown
  - The applicative protocol of the connection, or unknown. This is determined by analyzing the raw packets of the connection by using [nDPI](https://github.com/ntop/nDPI).
  - The server name information
  - The total traffic volume of the connection

By clicking on the connection it is possible to get more details about it.

<p align="center">
<img src="https://raw.githubusercontent.com/emanuele-f/PCAPdroid/master/assets/screenshots/connection_details.jpg" width="200" />
</p>

## 1.3 App Filter

By default PCAPdroid captures the packets of all the android apps. You can limit the capture to a specific app by clicking on the eye icon and selecting a specific app. The eye icon will be replaced by the target app icon. The capture will now affect only the specified application. This is expecially useful when using the [TLS decryption](tls_decryption) to ensure that only the target app traffic will be affected by the TLS decoding.

<p align="center">
<img src="https://raw.githubusercontent.com/emanuele-f/PCAPdroid/master/assets/screenshots/app_filter.jpg" width="200" />
</p>

In order for the app filter to work, PCAPdroid must map a network connection to a specific android app uid. Some traffic, however, is generated by system services, so the uid does not match the one of the target app. The most common example is the DNS traffic. Since PCAPdroid cannot determine from which app the DNS traffic is being generated, it will capture all the DNS traffic regardless of the app filter. This behavior can be changed by unchecking the "Capture Unknown Traffic" into the settings.
